<html>
<head>
</head>
<body>
<script>
    var apolloHttpLinkUrl = 'http://localhost:3000/graphql';
    var apolloWebSocketLinkUrl = 'ws://localhost:3000/subscriptions';

    var csrftoken = jsCookie('csrftoken') ? jsCookie('csrftoken') : '';
    var authLink = apolloSetContext((_, {headers}) => {
        // return the headers to the context so httpLink can read them
        return {
            headers: {
                ...headers,
                "X-CSRFToken": csrftoken
            }
        }
    });


    var COMMENT_QUERY = gql`
      subscription onCommentAdded {
        onCommentAdded {
          books {
            title
          }
        }
      }
    `;

    var httpLink = new apolloHttpLink({
        uri: apolloHttpLinkUrl
    });

    // Create a WebSocket link:
    var wsLink = new apolloWebSocketLink({
        uri: apolloWebSocketLinkUrl,
        options: {
            reconnect: true
        }
    });

    var client = new apolloClient({
        link: authLink.concat(apolloCreateUniLink(httpLink, wsLink), authLink),
        cache: new apolloInMemoryCache()
    });

    client.subscribe({
        query: COMMENT_QUERY,
        variables: {}
    }).subscribe(function (res) {
        console.log(Date.now(), 'client.subscribe', res);
    });
</script>
</body>
</html>