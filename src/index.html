<html>
<head>
</head>
<body>
<script>
    var apolloHttpLinkUrl = 'http://localhost:2000/graphql';
    var apolloWebSocketLinkUrl = 'ws://localhost:3000';

    var authLink = apolloSetContext((_, {headers}) => {
        // return the headers to the context so httpLink can read them
        return {
            headers: {
                ...headers,
                "X-CSRFToken": document.cookie['csrftoken'] ? document.cookie['csrftoken'] : ''
            }
        }
    });


    var COMMENT_QUERY = gql`
      query Comment($repoName: String!) {
        entry(repoFullName: $repoName) {
          comments {
            id
            content
          }
        }
      }
    `;

    var httpLink = new apolloHttpLink({
        uri: apolloHttpLinkUrl
    });

    // Create a WebSocket link:
    var wsLink = new apolloWebSocketLink({
        uri: apolloWebSocketLinkUrl,
        options: {
            reconnect: true
        }
    });

    var client = new apolloClient({
        link: authLink.concat(apolloCreateUniLink(httpLink, wsLink), authLink),
        cache: new apolloInMemoryCache()
    });

    client.watchQuery({
        query: COMMENT_QUERY,
        variables: {}
    }).subscribe(function (res) {
        console.log('client.watchQuery', res);
    });
</script>
</body>
</html>